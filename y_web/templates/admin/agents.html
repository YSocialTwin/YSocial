{% include "admin/head.html" %}

 <div class="view-wrapper is-dashboard">
        <!--Dashboard container-->
        <div id="creator-dashboard" class="dashboard-container">
            <!--Toolbar-->
            {% include "admin/dash_head.html" %}

            <div class="dashboard-body">
                <div class="columns">
                    <!--Dashboard column-->
                    <div class="column is-8">
                        <!--Dashboard box-->
                        <div class="dashboard-box">
                            <h3 class="title is-5 is-thin">Available Agents</h3>

                            <div class="box-content">


                                <div id="table"></div>

                                <script src="https://unpkg.com/gridjs/dist/gridjs.umd.js"></script>
                                <script>
                                      const tableDiv = document.getElementById('table');

                                      const updateUrl = (prev, query) => {
                                        return prev + (prev.indexOf('?') >= 0 ? '&' : '?') + new URLSearchParams(query).toString();
                                      };

                                      const editableCellAttributes = (data, row, col) => {
                                          if (row) {
                                            return {contentEditable: 'true', 'data-element-id': row.cells[0].data};
                                          }
                                          else {
                                            return {};
                                          }
                                      };

                                      new gridjs.Grid({
                                        columns: [
                                          { id: 'id', 'hidden': true },
                                          { id: 'name', name: 'Name', 'attributes': editableCellAttributes },
                                          { id: 'description', name: 'Description' },
                                            {id: 'details', name: 'Details', formatter: (cell) => {
                                                return gridjs.html(`<a href="/admin/agent_details/${cell}">Details</a>`);
                                            }},
                                        ],
                                        server: {
                                          url: '/admin/agents_data',
                                          then: results => results.data,
                                          total: results => results.total,
                                        },
                                        search: {
                                          enabled: true,
                                          server: {
                                            url: (prev, search) => {
                                              return updateUrl(prev, {search});
                                            },
                                          },
                                        },
                                        sort: {
                                          enabled: true,
                                          multiColumn: true,
                                          server: {
                                            url: (prev, columns) => {
                                              const columnIds = ['id', 'name', 'description'];
                                              const sort = columns.map(col => (col.direction === 1 ? '+' : '-') + columnIds[col.index]);
                                              return updateUrl(prev, {sort});
                                            },
                                          },
                                        },
                                        pagination: {
                                          enabled: true,
                                          server: {
                                            url: (prev, page, limit) => {
                                              return updateUrl(prev, {start: page * limit, length: limit});
                                            },
                                          },
                                        },
                                      }).render(tableDiv);

                                      let savedValue;

                                      tableDiv.addEventListener('focusin', ev => {
                                        if (ev.target.tagName === 'TD') {
                                          savedValue = ev.target.textContent;
                                        }
                                      });

                                      tableDiv.addEventListener('focusout', ev => {
                                        if (ev.target.tagName === 'TD') {
                                          if (savedValue !== ev.target.textContent) {
                                            fetch('/admin/agents_data', {
                                              method: 'POST',
                                              headers: {'Content-Type': 'application/json'},
                                              body: JSON.stringify({
                                                id: ev.target.dataset.elementId,
                                                [ev.target.dataset.columnId]: ev.target.textContent
                                              }),
                                            });
                                          }
                                          savedValue = undefined;
                                        }
                                      });

                                      tableDiv.addEventListener('keydown', ev => {
                                        if (ev.target.tagName === 'TD') {
                                          if (ev.key === 'Escape') {
                                            ev.target.textContent = savedValue;
                                            ev.target.blur();
                                          }
                                          else if (ev.key === 'Enter') {
                                            ev.preventDefault();
                                            ev.target.blur();
                                          }
                                        }
                                      });
                                </script>

                            </div>
                        </div>

                        <div class="dashboard-box">
                            <h3 class="title is-5 is-thin">Create Agent</h3>
                            <div class="box-media">
                                <img src="https://via.placeholder.com/1600x900" data-demo-src="assets/img/demo/unsplash/4.jpg" alt="" />
                            </div>
                            <div class="box-content">
                                <form action="/admin/add_user" enctype="multipart/form-data" method="POST">
                                <div class="box-lines">
                                    <h4><b>Simulation Models</b></h4>
                                    <div class="box-line">
                                        <span class="left">LLM</span>
                                        <div class="select">
                                                <select name="user_type">
                                                    <option value="llama3.1">LLama3.1</option>
                                                    <option value="mistral">Mistral</option>
                                                </select>
                                            </div>
                                    </div>
                                    <div class="box-line">
                                        <span class="left">Content RecSys</span>
                                        <div class="select">
                                                <select name="recsys_type">
                                                    <option value="ContentRecSys">Random</option>
                                                    <option value="ReverseChrono">(RC) Reverse Chrono</option>
                                                    <option value="ReverseChronoPopularity">(RC) Popularity</option>
                                                    <option value="ReverseChronoFollowers">(RC) Followers</option>
                                                    <option value="ReverseChronoFollowersPopularity">(RC) Followers-Popularity</option>
                                                </select>
                                            </div>
                                    </div>
                                    <div class="box-line">
                                        <span class="left">Friendship RecSys</span>
                                        <div class="select">
                                                <select name="frecsys_type">
                                                    <option value="FollowRecSys">Random</option>
                                                    <option value="CommonNeighbors">Common Neighbors</option>
                                                    <option value="Jaccard">Jaccard</option>
                                                    <option value="AdamicAdar">Adamic Adar</option>
                                                    <option value="PreferentialAttachment">Preferential Attachment</option>
                                                </select>
                                            </div>
                                    </div>
                                    <div class="box-line">
                                        <span class="left">Target Population</span>
                                        <div class="select">
                                                <select name="population">
                                                    <option value=""></option>
                                                </select>
                                            </div>

                                    </div>
                                    <hr>
                                    <h4><b>Demographic Information</b></h4>
                                    <div class="box-line">
                                        <span class="left">Agent Name</span>
                                        <span class="right" style="width: 70%;"><input type="text" id="username"  class="input"></span>
                                    </div>
                                    <div class="box-line">
                                        <span class="left">Age</span>
                                        <div class="slider-timeline">
                                        <input name="age" type="range" value="24" min="1" max="100" oninput="this.nextElementSibling.value = this.value">
                                        <output>24</output>
                                        </div>
                                    </div>
                                    <div class="box-line">
                                        <span class="left">Gender</span>
                                        <div class="select">
                                                <select name="gender">
                                                    <option value=""></option>
                                                    <option value="male">Male</option>
                                                    <option value="female">Female</option>
                                                </select>
                                            </div>
                                    </div>
                                    <div class="box-line">
                                        <span class="left">Language Spoken</span>
                                        <div class="select">
                                                <select name="language">
                                                    <option value="english">English</option>
                                                    <option value="italian">Italian</option>
                                                </select>
                                            </div>
                                    </div>
                                    <div class="box-line">
                                        <span class="left">Nationality</span>
                                        <div class="select">
                                        <select name="nationality">
                                            <option value="American">American</option>
                                            <option value="Argentine">Argentine</option>
                                            <option value="Armenian">Armenian</option>
                                            <option value="Austrian">Austrian</option>
                                            <option value="Azerbaijani">Azerbaijani</option>
                                            <option value="Bangladeshi">Bangladeshi</option>
                                            <option value="Belgian">Belgian</option>
                                            <option value="Brazilian">Brazilian</option>
                                            <option value="British">British</option>
                                            <option value="Bulgarian">Bulgarian</option>
                                            <option value="Chilean">Chilean</option>
                                            <option value="Chinese">Chinese</option>
                                            <option value="Colombian">Colombian</option>
                                            <option value="Croatian">Croatian</option>
                                            <option value="Czech">Czech</option>
                                            <option value="Danish">Danish</option>
                                            <option value="Dutch">Dutch</option>
                                            <option value="Estonian">Estonian</option>
                                            <option value="Finnish">Finnish</option>
                                            <option value="French">French</option>
                                            <option value="Georgian">Georgian</option>
                                            <option value="German">German</option>
                                            <option value="Greek">Greek</option>
                                            <option value="Hungarian">Hungarian</option>
                                            <option value="Indian">Indian</option>
                                            <option value="Indonesian">Indonesian</option>
                                            <option value="Iranian">Iranian</option>
                                            <option value="Irish">Irish</option>
                                            <option value="Israeli">Israeli</option>
                                            <option value="Italian">Italian</option>
                                            <option value="Japanese">Japanese</option>
                                            <option value="Latvian">Latvian</option>
                                            <option value="Lithuanian">Lithuanian</option>
                                            <option value="Mexican">Mexican</option>
                                            <option value="Nepalese">Nepalese</option>
                                            <option value="New Zealander">New Zealander</option>
                                            <option value="Norwegian">Norwegian</option>
                                            <option value="Palestinian">Palestinian</option>
                                            <option value="Polish">Polish</option>
                                            <option value="Portuguese">Portuguese</option>
                                            <option value="Romanian">Romanian</option>
                                            <option value="Russian">Russian</option>
                                            <option value="Saudi">Saudi</option>
                                            <option value="Slovak">Slovak</option>
                                            <option value="Slovenian">Slovenian</option>
                                            <option value="South African">South African</option>
                                            <option value="South Korean">South Korean</option>
                                            <option value="Spanish">Spanish</option>
                                            <option value="Swedish">Swedish</option>
                                            <option value="Swiss">Swiss</option>
                                            <option value="Taiwanese">Taiwanese</option>
                                            <option value="Thai">Thai</option>
                                            <option value="Turkish">Turkish</option>
                                            <option value="Ukrainian">Ukrainian</option>
                                        </select>
                                        </div>
                                    </div>
                                     <div class="box-line">
                                        <span class="left">Education Level</span>
                                         <div class="select">
                                                <select name="education_level">
                                                    <option value="high school">High School</option>
                                                    <option value="bachelor">Bachelor</option>
                                                    <option value="master">Master</option>
                                                    <option value="phd">PhD</option>
                                                </select>
                                            </div>
                                    </div>
                                    <hr>
                                    <h4><b>Thematic Characterization</b></h4>
                                    <div class="box-line">
                                        <span class="left">Political Leaning</span>
                                        <div class="select">
                                                <select name="leaning">
                                                    <option value=""></option>
                                                    <option value="democrat">Democrat</option>
                                                    <option value="republican">Republican</option>
                                                    <option value="centrist">Centrist</option>
                                                </select>
                                            </div>
                                    </div>
                                    <div class="box-line">
                                        <span class="left">Interests <small>(comma separated)</small></span>
                                        <span class="right" style="width: 70%;"><input type="text" id="interests" class="input" value=""></span>
                                    </div>

                                    <hr>

                                    <h4><b>Big Five Personality profile</b></h4>
                                    <div class="box-line">
                                        <span class="left">Openness to Experience</span>
                                        <div class="select">
                                                <select name="oe">
                                                    <option value=""></option>
                                                    <option value="inventive/curious">Inventive/Curious</option>
                                                    <option value="consistent/cautious">Consistent/Cautious</option>
                                                </select>
                                            </div>
                                    </div>
                                    <div class="box-line">
                                        <span class="left">Conscientiousness</span>
                                         <div class="select">
                                                <select name="co">
                                                    <option value=""></option>
                                                    <option value="efficient/organized">Efficient/Organized</option>
                                                    <option value="extravagant/careless">Extravagant/Careless</option>
                                                </select>
                                            </div>
                                    </div>
                                    <div class="box-line">
                                        <span class="left">Extraversion</span>
                                        <div class="select">
                                                <select name="ex">
                                                    <option value=""></option>
                                                    <option value="outgoing/energetic">Outgoing/Energetic</option>
                                                    <option value="solitary/reserved">Solitary/Reserved</option>
                                                </select>
                                            </div>
                                    </div>
                                    <div class="box-line">
                                        <span class="left">Agreeableness</span>
                                        <div class="select">
                                                <select name="ag">
                                                    <option value=""></option>
                                                    <option value="friendly/compassionate">Friendly/Compassionate</option>
                                                    <option value="critical/judgmental">Critical/Judgmental</option>
                                                </select>
                                            </div>
                                    </div>
                                    <div class="box-line">
                                        <span class="left">Neuroticism</span>
                                        <div class="select">
                                                <select name="ne">
                                                    <option value=""></option>
                                                    <option value="sensitive/nervous">Sensitive/Nervous</option>
                                                    <option value="resilient/confident">Resilient/Confident</option>
                                                </select>
                                            </div>
                                    </div>

                                    <hr>
                                    <h4><b>Expected Social Behavior</b></h4>
                                     <div class="box-line">
                                        <span class="left">Toxicity Level</span>
                                         <div class="select">
                                                <select name="toxicity_level">
                                                    <option value="none"></option>
                                                    <option value="low">Low</option>
                                                    <option value="medium">Medium</option>
                                                    <option value="high">High</option>
                                                </select>
                                            </div>

                                    </div>

                                    <hr>
                                    <h4><b>Advanced Role-Playing</b></h4>
                                    <p>Specifying the agent pre-prompt overrides the other configuration variables.</p>
                                     <div class="box-line">
                                        <span class="left">Alternative profile</span>
                                        <span class="right" style="width: 70%;"><input type="text" id="profile" class="input" value=""></span>
                                    </div>

                                </div>
                                <div class="button-wrap">
                                    <button class="button is-solid primary-button is-fullwidth">
                                        Create
                                    </button>
                                </div>
                                </form>
                            </div>
                        </div>
                        <!--Dashboard box-->

                    </div>


                    <!--Dashboard column-->
                    <div class="column is-4">
                        <!--Box-->
                        <div class="dashboard-box is-compact">
                            <h3 class="title is-5 is-thin">Guide</h3>
                            <div class="help-block">
                                <img class="light-image" src="assets/img/icons/questions/help.svg" alt="" />
                                <img class="dark-image" src="assets/img/icons/questions/help-dark.svg" alt="" />
                                <h4>Which Simulations?</h4>
                                <p>
                                    Here you can view all available simulations.
                                    Remember that you can only join one simulation at a time.
                                </p>
                                <br>

                                <h4>Static vs. Dynamic</h4>
                                    <p>
                                    Simulations can be either static or dynamic.

                                    <br><br>
                                     Static simulations are not currently running<br>
                                     Dynamic simulations are currently running
                                </p>
                            </div>
                        </div>


                    </div>
                </div>
            </div>
        </div>

    </div>

{% include "admin/footer.html" %}