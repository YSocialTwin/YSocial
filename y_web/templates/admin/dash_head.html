<!-- Release Update Banner (Admin Only) -->
{% if new_release_available and release_info %}
<div id="release-banner" style="background: linear-gradient(to right, #e3f2fd 0%, #f5f5f5 100%); border-left: 4px solid #039be5; border-radius: 4px; margin-bottom: 20px; position: relative; z-index: 1000;">
    <div style="padding: 12px 20px; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 12px;">
        <div style="display: flex; align-items: center; gap: 12px; flex: 1; min-width: 200px;">
            <div style="display: flex; align-items: center; justify-content: center; width: 32px; height: 32px; background: #039be5; border-radius: 50%; flex-shrink: 0;">
                <i class="mdi mdi-arrow-up-bold" style="color: white; font-size: 18px;"></i>
            </div>
            <div style="flex: 1;">
                <div style="font-size: 13px; color: #666; margin-bottom: 2px;">New Release Available!</div>
                <div style="font-size: 14px; color: #363636; font-weight: 500;">
                    {{ release_info.release_name }} <span style="color: #039be5; font-weight: 600;">(v{{ release_info.latest_version_tag }})</span>
                    <span style="color: #999; font-size: 12px; margin-left: 8px;">{{ release_info.published_at[:10] if release_info.published_at else '' }}</span>
                </div>
            </div>
        </div>
        <div style="display: flex; gap: 8px; align-items: center;">
            {% if release_info.download_url %}
            {% set is_github_page = 'github.com' in release_info.download_url and '/releases/tag/' in release_info.download_url %}
            <a href="{{ release_info.download_url }}" target="_blank" style="display: inline-flex; align-items: center; gap: 6px; background: #039be5; color: white; padding: 6px 14px; border-radius: 4px; text-decoration: none; font-size: 13px; font-weight: 500; transition: background 0.2s;">
                {% if is_github_page %}
                <i class="mdi mdi-open-in-new" style="font-size: 16px;"></i>
                <span>View Release</span>
                {% else %}
                <i class="mdi mdi-download" style="font-size: 16px;"></i>
                <span>Download</span>
                {% endif %}
            </a>
            {% endif %}
            <button onclick="document.getElementById('release-banner').style.display='none';" style="background: transparent; border: 1px solid #ddd; color: #666; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 13px; transition: all 0.2s;" onmouseover="this.style.borderColor='#039be5'; this.style.color='#039be5';" onmouseout="this.style.borderColor='#ddd'; this.style.color='#666';">
                <i class="mdi mdi-close" style="font-size: 14px;"></i>
            </button>
        </div>
    </div>
</div>
{% endif %}

<!-- Blog Post Banner (Admin Only) -->
{% if new_blog_post_available and blog_post %}
<div id="blog-banner" style="background: linear-gradient(to right, #fff3e0 0%, #f5f5f5 100%); border-left: 4px solid #ff9800; border-radius: 4px; margin-bottom: 20px; position: relative; z-index: 999;">
    <div style="padding: 12px 20px; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 12px;">
        <div style="display: flex; align-items: center; gap: 12px; flex: 1; min-width: 200px;">
            <div style="display: flex; align-items: center; justify-content: center; width: 32px; height: 32px; background: #ff9800; border-radius: 50%; flex-shrink: 0;">
                <i class="mdi mdi-post" style="color: white; font-size: 18px;"></i>
            </div>
            <div style="flex: 1;">
                <div style="font-size: 13px; color: #666; margin-bottom: 2px;">New Blog Post!</div>
                <div style="font-size: 14px; color: #363636; font-weight: 500;">
                    {{ blog_post.title }}
                    <span style="color: #999; font-size: 12px; margin-left: 8px;">{{ blog_post.published_at[:10] if blog_post.published_at else '' }}</span>
                </div>
            </div>
        </div>
        <div style="display: flex; gap: 8px; align-items: center;">
            <a href="{{ blog_post.link }}" target="_blank" onclick="markBlogPostAsRead({{ blog_post.id }})" style="display: inline-flex; align-items: center; gap: 6px; background: #ff9800; color: white; padding: 6px 14px; border-radius: 4px; text-decoration: none; font-size: 13px; font-weight: 500; transition: background 0.2s;">
                <i class="mdi mdi-open-in-new" style="font-size: 16px;"></i>
                <span>Read Article</span>
            </a>
            <button onclick="dismissBlogPost({{ blog_post.id }})" style="background: transparent; border: 1px solid #ddd; color: #666; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 13px; transition: all 0.2s;" onmouseover="this.style.borderColor='#ff9800'; this.style.color='#ff9800';" onmouseout="this.style.borderColor='#ddd'; this.style.color='#666';">
                <i class="mdi mdi-close" style="font-size: 14px;"></i>
            </button>
        </div>
    </div>
</div>

<script>
function markBlogPostAsRead(postId) {
    // Mark blog post as read when link is clicked
    fetch('/admin/mark_blog_post_read/' + postId, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        }
    }).then(() => {
        document.getElementById('blog-banner').style.display = 'none';
    }).catch(error => {
        console.error('Error marking blog post as read:', error);
    });
}

function dismissBlogPost(postId) {
    // Mark blog post as read when dismissed
    fetch('/admin/mark_blog_post_read/' + postId, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        }
    }).then(() => {
        document.getElementById('blog-banner').style.display = 'none';
    }).catch(error => {
        console.error('Error dismissing blog post:', error);
    });
}
</script>
{% endif %}

<div class="dashboard-toolbar">
    <h1 class="title is-4"></h1>
    <div class="actions">
        <!-- <label class="theme-toggle" {# title="Toggle night mode" #}>
            <input type="checkbox"/>
            <span class="toggler">
          <span class="dark">
            <i data-feather="moon"></i>
          </span>
                        <span class="light">
            <i data-feather="sun"></i>
          </span>
                        </span>
        </label> -->
        <div class="buttons">
            {% if active_experiments %}
                {% if active_experiments|length == 1 %}
                    {# Single experiment - direct link #}
                    <a class="button is-solid live-button has-icon" href="/admin/join_experiment/{{ active_experiments[0].idexp }}">
                        <i data-feather="video"></i>
                        <span>Join {{ active_experiments[0].exp_name }}</span>
                    </a>
                {% else %}
                    {# Multiple experiments - dropdown menu #}
                    <div class="dropdown is-hoverable">
                        <div class="dropdown-trigger">
                            <button class="button is-solid live-button has-icon" aria-haspopup="true" aria-controls="join-simulation-menu">
                                <i data-feather="video"></i>
                                <span>Join Simulation</span>
                                <i data-feather="chevron-down" style="margin-left: 0.5rem; width: 16px; height: 16px;"></i>
                            </button>
                        </div>
                        <div class="dropdown-menu" id="join-simulation-menu" role="menu">
                            <div class="dropdown-content">
                                {% for exp in active_experiments %}
                                <a href="/admin/join_experiment/{{ exp.idexp }}" class="dropdown-item">
                                    {{ exp.exp_name }}
                                </a>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                {% endif %}
            {% else %}
                {# No active experiments - disabled button #}
                <button class="button is-solid live-button has-icon is-disabled" disabled title="No active experiments available">
                    <i data-feather="alert-circle"></i>
                    <span>No Active Experiments</span>
                </button>
            {% endif %}
            <a class="button is-solid has-icon" href="/logout" style="margin-left: 0.5rem;">
                <i data-feather="log-out"></i>
                <span>Log Out</span>
            </a>
        </div>
    </div>
</div>